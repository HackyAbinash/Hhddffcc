var b$=b$||{};b$.universal=b$.universal||{},b$.universal.widgets=b$.universal.widgets||{},b$.universal.widgets.StructuredContentOverlays=function(M){"use strict";define("tc-overlay",function(H,e,t){t.exports={tcOverlay:function(c,e,n,a,t){var r,o;M.ajax({url:e,success:function(e){var t=e;if(r=t.pageId,null!=t.TextArray)for(var o=0;o<t.TextArray.length;o++)t.TextArray[o].bodyBorderTop&&M(c.htmlNode).find(".tc-overlay .main-body .main-container:eq("+o+")").addClass("sections-border"),M(c.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .ind-row").html(t.TextArray[o].richTextItem),M(c.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .left-content").html(t.TextArray[o].leftText),M(c.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .right-content").html(t.TextArray[o].rightText),M(c.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .center-content").html(t.TextArray[o].centerText);M(c.htmlNode).find(".tc-overlay .popup-heading").text(t.overlayTitle),t.heading&&M(c.htmlNode).find(".tc-overlay .heading").text(t.heading),M(c.htmlNode).find(".tc-overlay .fb-img-container .left-img .fbleft").text(t.feedbackImgOneText),M(c.htmlNode).find(".tc-overlay .fb-img-container .right-img .fbright").text(t.feedbackImgTwoText),M(c.htmlNode).find(".tc-overlay .fb-img-container .small-gray-text").text(t.thirdPartyNotice),M(c.htmlNode).find(".tc-overlay .download-container .downLabel").text(t.downloadLabel),M(c.htmlNode).find(".tc-overlay .sms-captcha-container .smsLabel").text(t.getSmsLabel)},error:function(e){}}),"tnc"==n?o="overlay-terms-conditions":"downloadApp"==n?o="overlay-download-app":"feedback"==n?o="overlay-feedback":"feesAndCharges"==n?o="overlay-fees-charges":"howToGetStarted"==n&&(o="overlay-get-started"),M(c.htmlNode).find(".tc-overlay").addClass(o),M(".play-button").on("click",function(){b$.portal.isLogin&&0<M(".web-portal").length&&M(".lp-widget-hdfc-nb-breadcrumb").hide()}),M(".close-button").on("click",function(){b$.portal.isLogin&&0<M(".web-portal").length&&M(".lp-widget-hdfc-nb-breadcrumb").show()}),M(c.htmlNode).find(".tc-overlay .cover").on("click",function(e){var t=e.target.href;null!=t&&null!=t&&-1<t.indexOf("http")&&t.indexOf(window.location.hostname)<0&&(e.target.target="_blank")}),gadgets.pubsub.subscribe("overlayTypeToOpened",function(e){var t=e.overlayType,o=e.sequenceNumber;b$.portal.isLogin&&0<M(".web-portal").length&&M(".lp-widget-hdfc-nb-breadcrumb").hide(),n==t&&a==o&&("downloadApp"==n&&L(),M(c.htmlNode).find(".cover").css("display","block"),M("body").addClass("noScroll"),M(c.htmlNode).find(".popup-container").addClass("opened"))});function d(){M(c.htmlNode).find(".tc-overlay").hasClass("overlay-download-app")&&(M(c.htmlNode).find(".modal-body").show(),M(c.htmlNode).find(".download-success-container, .download-error-container").hide(),M(c.htmlNode).find(".mobile-number").val(""),M(c.htmlNode).find(".captcha-image").empty(),M(c.htmlNode).find(".captcha-input").val(""),M(c.htmlNode).find(".get-captcha-error").hide(),M(c.htmlNode).find(".get-sms-error").hide(),M(c.htmlNode).find(".country-codes").val(M(".country-codes option:first").val()),M(c.htmlNode).find(".captcha-input").removeClass("captcha-error"))}M(c.htmlNode).find(".tc-overlay .popup-download").on("click",function(){H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/html2canvas"]),0<M(c.htmlNode).find(".modal-content .ind-row table").length&&0==M(c.htmlNode).find(".modal-content .ind-row table p").length&&H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/pdfmake.min"],function(){H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/vfs_fonts"],function(){for(var e,t=M(c.htmlNode).find(".modal-content table")[0],o="",n=0;e=t.rows[n];n++){for(var a,r=0;a=e.cells[r];r++)a.innerText=a.innerText.replace(/^\s+|\s+$/g,""),o=o+" "+a.innerText;o+="\n\n"}var d=M(c.htmlNode).find(".modal-content .modal-header"),i=d.height();html2canvas(d,{onrendered:function(e){var t={pageMargins:[40,0,40,40],content:[{image:e.toDataURL("image/jpeg"),height:i-10,width:595,style:"header"},{text:o}],styles:{header:{margin:[0,0,0,10],alignment:"center"}}};M(c.htmlNode).find(".modal-content").attr("style",""),M("body").attr("style",""),M(c.htmlNode).find(".popup-container.opened").removeClass("download-in-progress"),M(c.htmlNode).find(".modal.popup-container.opened .button-options").show(),pdfMake.createPdf(t).download("download.pdf")}})})})}),M(c.htmlNode).find(".close-button,.logo-section .icon-left-open-big").on("click",function(){M(c.htmlNode).find(".cover").css("display","none"),M("body").removeClass("noScroll"),M(c.htmlNode).find(".popup-container").removeClass("opened"),d()}),gadgets.pubsub.subscribe("overlayClosed",function(){d()}),M(c.htmlNode).find(".popup-print").on("click",function(){M("body").css("visibility","hidden"),window.print(),M("body").css("visibility","visible")});var s,p,h,f,m,i=[],u=[],l=function(e){f=s.height(),m=s.width();for(var o,t=Math.ceil(f/h),n=0;n<t;n++){var a=document.createElement("canvas"),r=a.getContext("2d");a.width=m,a.height=h,p.height<h+5&&(h=p.height-5),a.height=h,r.drawImage(p,0,n*h,m,h+5,0,0,a.width,a.height+5);for(var d=r.getImageData(0,0,a.width,a.height),i=d.data,l=0;l<i.length;l+=4)i[l+3]<255&&(i[l]=255,i[l+1]=255,i[l+2]=255,i[l+3]=255);r.putImageData(d,0,0),u.push(a.toDataURL("image/jpeg"))}o=u.length-1,H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/jspdf"],function(){var t=new jsPDF;u.forEach(function(e){t.addImage(e,"JPEG",10,9),o&&t.addPage(),o--}),void 0!==M.browser.safari?t.output("datauri"):t.save(void 0),s.attr("style",""),M("body").attr("style",""),M(c.htmlNode).find(".popup-container.opened").removeClass("download-in-progress"),M(c.htmlNode).find(".modal.popup-container.opened .button-options").show()})},g=function(){new Promise(function(t,e){H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/html2canvas"],function(){html2canvas(s,{onrendered:function(e){t(e)}})})}).then(function(e){(p=new Image).src=e.toDataURL("image/jpeg"),p.onload=l})};M(c.htmlNode).find(".tc-overlay .popup-download").on("click",function(){M(c.htmlNode).find(".modal.popup-container.opened .button-options").hide(),(0==M(c.htmlNode).find(".modal-content .ind-row table").length||0<M(c.htmlNode).find(".modal-content .ind-row table p").length)&&(M(c.htmlNode).find(".popup-container.opened").addClass("download-in-progress"),setTimeout(function(){s=M(c.htmlNode).find(".modal-content"),i=[760,888],M(window).outerWidth()<790&&540<M(window).outerWidth()&&(i[0]=550),h=i[1],f=s.height(),M("body").scrollTop(0),(u=[]).length=0,g()},100))});var v=[];M(c.htmlNode).find(".hidden-country-codes li").each(function(){v.push(M(this).text())});for(var b='<select class="form-control country-codes">',y=0;y<v.length;y++)b=b+'<option value="'+v[y]+'">'+v[y]+"</option>";b+="</select>";var N=b$.portal.portalModel.serverURL,w=M('<img class="refresh-icon">');w.attr("src",N+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/refresh.png");var T=M('<img id ="voice-icon">');T.attr("src",N+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/voice.png");var x,B,C,D,O,S,P,k;function L(){M.ajax({url:window.location.origin+"/services/proxy/getCaptcha",type:"GET",async:!1,success:function(e){var t=JSON.parse(e);x=t.captchaId,""!=B&&(B=" "),B="data:data/png;base64,"+t.captchaImg,C=t.captchaAudio,(D=M('<img id="captcha-image">')).attr("src",B),""==B||"undefined"==B?M(c.htmlNode).find(".sms-captcha-container").addClass("captcha-not-pres"):(M(c.htmlNode).find(".sms-captcha-container").removeClass("captcha-not-pres"),M(c.htmlNode).find(".captcha-image").append(D))}})}function I(){M(c.htmlNode).find(".captcha-image").empty(),M(c.htmlNode).find(".get-captcha-error").hide(),M(c.htmlNode).find(".get-sms-error").hide(),M(c.htmlNode).find(".captcha-input").removeClass("captcha-error"),L()}function $(){if(""!=k){var e={captchaId:x,mobileNumber:P.trim()+S.trim(),captchaValue:k.trim(),appId:r};e=JSON.stringify(e);var t=window.location.origin+"/services/proxy/verifyCaptcha";M.ajax({method:"POST",url:t,headers:{"Content-Type":"text/plain"},data:e}).done(function(e){var t=JSON.parse(e);0==t.rc.returncode?(M(c.htmlNode).find(".get-sms-error").hide(),M(c.htmlNode).find(".modal-body").hide(),M(c.htmlNode).find(".download-success-container").show()):"A1208"==t.rc.errorcode?(I(),M(c.htmlNode).find(".get-captcha-error").show(),M(c.htmlNode).find(".captcha-input").addClass("captcha-error")):A()}).fail(function(e){A()})}else I(),M(c.htmlNode).find(".get-sms-error").hide(),M(c.htmlNode).find(".get-captcha-error").show(),M(c.htmlNode).find(".captcha-input").addClass("captcha-error")}function A(){M(c.htmlNode).find(".get-sms-error").hide(),M(c.htmlNode).find(".modal-body").hide(),M(c.htmlNode).find(".download-error-container").show()}M(c.htmlNode).find(".get-sms-interaction-code").append(b),M(c.htmlNode).find(".get-sms-interaction").append('<input type="text" name="mobile-number" placeholder="Enter Mobile Number" class="form-control mobile-number" />'),M(c.htmlNode).find(".get-sms-interaction").append('<label class="get-sms-error col-xs-12">Sorry, You have entered an invalid phone number. Please enter your valid phone number.</label>'),M(c.htmlNode).find(".refresh").append(w),M(c.htmlNode).find(".voice").append(T),M(c.htmlNode).find(".captcha-input-val").append('<label class="captcha-text">Type the text displayed above.</label>'),M(c.htmlNode).find(".captcha-input-val").append('<input type="text" name="captcha-input" class="form-control captcha-input"/>'),M(c.htmlNode).find(".captcha-input-val").append('<label class="get-captcha-error col-xs-12">Text did not match. Please type the correct code displayed above.</label>'),M(c.htmlNode).find(".get-sms-btn").append('<a class="btn-primary send-code">GET LINK</a>'),M(c.htmlNode).find(".refresh").click(function(){I()}),M(c.htmlNode).find(".voice").click(function(){var e=new Audio("data:audio/mp3;base64,"+C);e.play(),M(c.htmlNode).find(".close-button,.logo-section .icon-left-open-big").on("click",function(){e.pause()})}),M(c.htmlNode).find(".get-sms-btn").click(function(){O=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[6789]\d{9}$/i,S=M(c.htmlNode).find(".mobile-number").val(),P=M(c.htmlNode).find(".country-codes option:selected").text(),k=M(c.htmlNode).find(".captcha-input").val(),"91"==P.replace("+","")?O.test(S)?$():(M(c.htmlNode).find(".get-sms-error").show(),M(c.htmlNode).find(".get-captcha-error").hide(),M(c.htmlNode).find(".captcha-input").removeClass("captcha-error")):""!=S||"undefined"==S?""!=k||"undefined"==k?$():(M(c.htmlNode).find(".get-captcha-error").show(),M(c.htmlNode).find(".captcha-input").addClass("captcha-error"),M(c.htmlNode).find(".get-sms-error").hide()):M(c.htmlNode).find(".get-sms-error").show()})}}});var w="cs";return{prefModified:function(e){e.refreshIncludes();var t=M(e.htmlNode);M(".bd-structured-content-widget",t).attr("data-type",e.getPreference("contentType")||"Content")},start:function(d){var n,e=d.getPreference("contentRef"),a=M(d.htmlNode),t=!1;try{top.bd}catch(e){t=!0}for(var o,r=!(!window.be||t)&&be.utils.module("top.bd.PageMgmtTree.selectedLink").isMasterPage||"true"===d.model.manageable||""===d.model.manageable||void 0===d.model.manageable,i=[],l=0;l<d.model.preferences.array.length;l++)"templateUrl"==d.model.preferences.array[l].name&&(o=d.model.preferences.array[l].value);var c=d.getPreference("urlContent"),s=b$.portal.portalModel.serverURL;if(null!=c){var p=c.indexOf("content"),h=c.slice(p,c.length);c=s+"/"+h}var f=b$.portal.portalModel.serverURL,m=f+"/static/features/%5BBBHOST%5D/feature-hdfc-slick-slider/media/pop-close.png";M(".close-icon-url").attr("src",m);var u=f+"/static/features/%5BBBHOST%5D/feature-hdfc-download-pdf/media/print-36-26.png",g=f+"/static/features/%5BBBHOST%5D/feature-hdfc-download-pdf/media/download-36-26.png";M(".tc-overlay .button-options .popup-print img").attr("src",u),M(".tc-overlay .button-options .popup-download img").attr("src",g);var v=f+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/success-arrow.png",b=f+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/failure.png";if(M(".tc-overlay .download-success-container img").attr("src",v),M(".tc-overlay .download-error-container img").attr("src",b),null==o&&null==o||(i=o.split("/")),r){e||a.addClass("bd-empty-structured-content"),M(".bd-structured-content-widget",a).attr("data-type",d.getPreference("contentType")||"Content"),d.addEventListener("preferences-form",function(e){for(var t=b$.portal.portalModel.filterPreferences(d.model.preferences.array),o=t.length-1;0<=o;o--)if("Template"==t[o].label)for(var n=d.getPreference("templateList").split(","),a=0,r=0;a<n.length;a++,r++)t[o].inputType.options[r]={label:n[a],value:n[a+1]},a++}),d.addEventListener("bdDrop.enter",function(e){var t=e.detail.info.helper.bdDragData.fileDataArray[0];t.metaData&&t.metaData["cmis:objectTypeId"]&&"bb:structuredcontent"===t.metaData["cmis:objectTypeId"].property?(n=t,a.addClass("bd-over-structured-content")):n=void 0}),d.addEventListener("bdDrop.leave",function(e){a.removeClass("bd-over-structured-content")}),d.addEventListener("bdDrop.drop",function(e){var t=e.detail.info.helper.bdDragData.fileDataArray[0];if(n){if(!d.model.preferences.getByName("contentRef")){var o=b$.portal.portalModel.createPreference("contentRef","contentRef",void 0,"");d.model.preferences.add(o)}d.setPreference("urlContent",t.url),d.setPreference("contentRef",[w,"contentRepository"===n.repository?n.repository:"@portalRepository",n.contentUId].join(":")),d.model.save(function(){d.refreshHTML(),a.removeClass("bd-empty-structured-content")}),a.removeClass("bd-over-structured-content")}n=void 0}),window.bd&&window.bd.bindDropEvents&&window.bd.bindDropEvents(d.htmlNode);var y=d.getPreference("overlayType"),N=d.getPreference("occurrenceSeq");"tc-overlay.html"==i[i.length-1].trim()&&require(["tc-overlay"],function(e){e.tcOverlay(d,c,y,N,s)})}}}}(jQuery);